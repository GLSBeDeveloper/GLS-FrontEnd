(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"0JXp":function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i("Wy0B"),r=i("UKIU"),a=function(){return function(e,t){var i=this;this._mdDialog=e,this.title="",this.tableHeight=800,this.tableColumn=n.k.DeliveryDetail,this.tableData=[],this.tableItemActions=[{tooltip:"Open",icon:"launch",click:function(e){i._mdDialog.open(r.a,{maxWidth:"100vw",maxHeight:"100vh",data:{orderId:e.DeliveryMasterId,readOnly:!1}}).afterClosed()}}],this.tableHeight=window.innerHeight-125,Object.assign(this,t)}}()},"3/ER":function(e,t,i){"use strict";(function(e){var n=i("Ju5/"),r="object"==typeof exports&&exports&&!exports.nodeType&&exports,a=r&&"object"==typeof e&&e&&!e.nodeType&&e,o=a&&a.exports===r?n.a.Buffer:void 0,s=o?o.allocUnsafe:void 0;t.a=function(e,t){if(t)return e.slice();var i=e.length,n=s?s(i):new e.constructor(i);return e.copy(n),n}}).call(this,i("3UD+")(e))},"9WoD":function(e,t,i){var n=i("yNUO");e.exports=function(e,t,i){var r=n(e).getTime(),a=n(t).getTime(),o=n(i).getTime();if(a>o)throw new Error("The start of the range cannot be after the end of the range");return r>=a&&r<=o}},BCsM:function(e,t,i){"use strict";i.d(t,"a",function(){return h});var n=i("+dGY"),r=i("xMyE"),a=i("buEt"),o=i("/Tkk"),s=i("7EGn"),c=(i("D8hx"),i("auuj"),i("pLIX")),l=i("cmJY"),u=i("Wy0B"),d=(i("bri6"),i("sA4U")),h=(i("Rf/f"),function(){function e(e,t,i,r,o,s,l){var u=this;this._plannerRest=e,this._messageRest=t,this._socket=i,this._localStorage=r,this._loading=o,this._authentication=s,this._toast=l,this.Item=new d.a,this.Vehicle=new d.a,this.VehicleType=new d.a,this.DeliveryDetail=new d.a,this.DeliveryMaster=new d.a,this.DeliveryPlan=new d.a,this.Message=new d.a,this.importedExcel={},this.onPlanChanged=new a.a,this.dispatchPanelToggled$=new a.a,this.DeliveryDetail.queryObject=new c.a({startDate:void 0,endDate:void 0,finishedJob:!1}),this.notificationMsg=this._localStorage.get("deliveryDetails.attempted",15),this._loading.create({name:"fullscreen",mode:n.d.Indeterminate,type:n.e.Circular,color:"warn"}),d.a.beforeDataQuery=function(){return u._loading.register("fullscreen")},d.a.afterDataQuery=function(){return u._loading.resolve("fullscreen")},this.Item.getDataHandler=function(){return u._plannerRest.getItems(!0)},this.Vehicle.getDataHandler=function(){return u._plannerRest.getVehicles(void 0,!0)},this.VehicleType.getDataHandler=function(){return u._plannerRest.getVehicleTypes(!0)}}return e.prototype.addListeners=function(e){var t=this;["DeliveryDetail","VehicleType","Vehicle","Item"].filter(function(t){return e.includes(t)}).forEach(function(e){t._socket.onJSON(e,function(i){t._authentication.user&&t._socketUpdate(e,i)})}),e.includes("DeliveryMaster")&&this._socket.onJSON("DeliveryMaster",function(e){t._authentication.user&&t._socketUpdateDeliveryMaster(e)}),e.includes("Message")&&this._socket.onJSON("Message",function(e){t._authentication.user&&t._socketUpdateMessage(e)}),e.includes("DeliveryPlan")&&this._socket.onJSON("DeliveryPlan",function(e){t._authentication.user&&t._socketUpdateDeliveryPlan(e)}),this._socket.onJSON("logout",function(){t._authentication.user&&t.clearCache()})},e.prototype.removeAllListeners=function(){this._socket.removeAllListeners()},e.prototype.get=function(e){return this[e]},e.prototype.setDeliveryDetailCachedObject=function(e,t){var i=this;void 0===t&&(t=!0);var n=this.DeliveryDetail;n.queryObject.isSameWith(e)||(Object.assign(n.queryObject,e),n.getDataHandler=function(){return i._plannerRest.getDeliveryDetails(n.queryObject.startDate,n.queryObject.endDate,n.queryObject.getStatusQuery(),!0)},n.shouldDataBeUpdated=function(e){return!0}),t&&n.refresh()},e.prototype.setMessageCachedObject=function(e,t){var i=this;void 0===t&&(t=!0);var n=this.Message;n.queryObject=e,n.getDataHandler=function(){return i._messageRest.getAll(n.queryObject.startDate,n.queryObject.endDate)},n.shouldDataBeUpdated=function(e){return l.a.isWithinDateRange(e.modified_date,n.queryObject.startDate,n.queryObject.endDate)},t&&n.refresh()},e.prototype.setDeliveryPlanCachedObject=function(e,t){var i=this;void 0===t&&(t=!0);var n=function(e){return[11].indexOf(e.status)>-1},a=this.DeliveryPlan;a.queryObject=e,a.getDataHandler=function(){return i._plannerRest.getProblemJson(a.queryObject).pipe(Object(r.a)(function(e){e.services=e.services.filter(function(e){return!n(e)}),e.shipments=e.shipments.filter(function(e){return!n(e)}),e.solutions.forEach(function(e){return e.checked=!1}),e.services.forEach(function(e){e.dueTime=Object(s.a)(e,"time_windows[0].end"),"DELIVERY"===e.type.toUpperCase()?e.deliveryDue=e.dueTime:e.pickupDue=e.dueTime}),e.shipments.forEach(function(e){e.dueTime=Object(s.a)(e,"delivery_time_windows[0].end"),e.deliveryDue=e.dueTime,e.pickupDue=Object(s.a)(e,"pickup_time_windows[0].end"),e.pickup_status===e.delivery_status&&(e.status=e.pickup_status)})}))},t&&a.refresh()},e.prototype.clearCache=function(){this.Item.clearCache(),this.Vehicle.clearCache(),this.VehicleType.clearCache(),this.DeliveryDetail.clearCache(),this.DeliveryMaster.clearCache(),this.DeliveryPlan.clearCache(),this.Message.clearCache()},e.prototype._socketUpdate=function(e,t){var i=this;if(console.log("PlannerDataService -> _socketUpdate -> msg",t),t&&t.data&&t.purpose){var n=this.get(e);"delete"!==t.purpose&&(t.data=t.data.filter(function(e){return n.shouldDataBeUpdated(e)}));var r=l.a.updateCreateAndRemoveAccordingToWS(t,n.cachedData||[]);r.length>0?(console.log("PlannerDataService -> _socketUpdate -> affected",r),"attempted"===t.purpose?r.forEach(function(e){var t="Delivered "+e.DeliveryMasterId+" ("+e.JobType+") : "+u.m[e.Status]+" on "+new Date(e.ActualDeliveryTime).toLocaleTimeString();i._authentication.jobBellNotification&&i.notificationMsg.unshift(e),i._showDataToastMessage(t)}):this._showDataToastMessage("Table "+e+": "+r.length+" items have been "+t.purpose+"d"),n.updateSubject.next({data:r,purpose:t.purpose})):console.log("PlannerDataService -> _socketUpdate -> No affected items")}},e.prototype._socketUpdateDeliveryMaster=function(e){var t=this;if(console.log("PlannerDataService -> _socketUpdateDeliveryMaster -> msg",e),e&&e.data&&e.purpose){var i=this.DeliveryDetail,n=[];if(["update","create"].includes(e.purpose)){var r=[];e.data.forEach(function(e){e.DeliveryDetails&&e.DeliveryDetails.forEach(function(n){i.shouldDataBeUpdated(n)&&r.push(t._updateJob(n,e))});var n=i.cachedData.find(function(t){return t.DeliveryMasterId===e.Id});n&&(n.DeliveryMaster.CustomerName=e.CustomerName,n.DeliveryMaster.CustomerPhone=e.CustomerPhone,n.DeliveryMaster.CustomerEmail=e.CustomerEmail,r.push(t._updateJob(n,e)))}),n=l.a.updateItemsToArray(r,i.cachedData)}else if("delete"===e.purpose){var a=i.cachedData.filter(function(t){return e.data.includes(t.DeliveryMasterId)}).map(function(e){return e.Id});n=l.a.removeItemsFromArray(a,i.cachedData)}n.length>0&&(console.log("PlannerDataService -> _socketUpdateDeliveryMaster -> affected",n),this._showDataToastMessage("Orders: "+n.length+" items have been "+e.purpose+"d"),i.updateSubject.next({data:n,purpose:e.purpose}))}},e.prototype._socketUpdateDeliveryPlan=function(e){if(console.log("PlannerDataService -> _socketUpdateDeliveryPlan -> msg",e),e&&e.data&&e.purpose){var t=this.DeliveryPlan;["update","create"].includes(e.purpose)&&o(e.data,t.queryObject)&&(t.refresh(),this._showDataToastMessage("PLANNER_PLAN.NEWPLAN_APPROVED_MSG"))}},e.prototype._socketUpdateMessage=function(e){if(console.log("PlannerDataService -> _socketUpdateMessage -> msg",e),e&&e.data&&e.purpose){var t=this.Message,i=e.data.filter(function(e){return t.shouldDataBeUpdated(e)});console.log("private_socketUpdateMessage -> affected",i,e.data,t.queryObject),["update","create"].includes(e.purpose)&&(this._authentication.msgToastNotification&&this._toast.shortAlert("Message: "+i.length+" messages have been "+e.purpose+"d"),t.updateSubject.next({data:i,purpose:e.purpose}))}},e.prototype._showDataToastMessage=function(e){this._authentication.dataToastNotification&&this._toast.shortAlert(e)},e.prototype._updateJob=function(e,t){return e.VehicleId=t.VehicleId,e.Priority=t.Priority,e.VehicleRestriction=t.VehicleRestriction,e.UserGroup=t.UserGroup,e},e}())},Cmri:function(e,t,i){"use strict";var n=i("mrSG"),r=i("PVOQ"),a=i("Wy0B"),o=i("S0mB"),s=i("jXxP"),c=i("aS0w"),l=i("go+/"),u=i("QaIH"),d=i("nP1h"),h=i("0JXp"),p=i("UKIU");i.d(t,"a",function(){return m});var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(n.b)(t,e),t.prototype.openOrderDetail=function(e,t){return void 0===t&&(t=!0),this.openWithConfig(p.a,{maxWidth:"100vw",maxHeight:"100vh",minWidth:"100vw",minHeight:"100vh",data:{order:e,readOnly:t}})},t.prototype.openOrderDetailById=function(e,t){return void 0===t&&(t=!0),this.openWithConfig(p.a,{maxWidth:"100vw",maxHeight:"100vh",minWidth:"100vw",minHeight:"100vh",data:{orderId:e,readOnly:t}})},t.prototype.openJobList=function(e,t){return void 0===t&&(t="Order "),this.openWithConfig(h.a,{maxWidth:"100vw",maxHeight:"100vh",data:{tableData:e,title:t}})},t.prototype.openOptimizationSelection=function(e){return this.openWithConfig(r.a,{maxWidth:"100vw",maxHeight:"100vh",data:Object.assign({},e,{optimizationConfig:a.d,vehicleColumns:a.f,orderColumns:a.e})})},t.prototype.openDateSelection=function(e){return this.openWithConfig(c.a,{maxWidth:"100vw",maxHeight:"100vh",data:{viewDate:e}})},t.prototype.openDateRangeSelection=function(e,t){return void 0===e&&(e=new Date),void 0===t&&(t=new Date),this.open(s.a,{start:e,end:t})},t.prototype.openTimeRangeSelection=function(e,t){return void 0===e&&(e="00:00"),void 0===t&&(t="23:59"),this.openDynamicEdit([{name:"start",label:"Start Time",type:"time",default:e},{name:"end",label:"End Time",type:"time",default:t}],void 0,"Select date range",1)},t.prototype.openVehicleDetail=function(e,t,i){return void 0===i&&(i=!1),this.open(u.a,{value:e,driverUsers:t,isPowerPlanner:i})},t.prototype.openVehicleTypeDetail=function(e,t){return this.open(d.a,{value:e,allVehicleTypeNames:t})},t.prototype.openItemDetail=function(e,t){return void 0===t&&(t=[]),this.open(l.a,{value:e,allItemIds:t})},t}(o.a)},D8hx:function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i("CcnG"),r=i("vARd"),a=i("A7o+"),o=function(){function e(e,t){this._snackBarService=e,this._translate=t}return e.prototype.shortAlert=function(e,t){void 0===t&&(t=void 0);var i=this._t(e),n=3e3;t&&t.error&&(n=5e3,i="\u274c "+(t.error instanceof Array?t.error[0]:t.error)),this._snackBarService.open(i,"Dismiss",{panelClass:["text-break"],duration:n})},e.prototype._t=function(e){return e?this._translate.instant(e):e},e.ngInjectableDef=n.T({factory:function(){return new e(n.X(r.b),n.X(a.k))},token:e,providedIn:"root"}),e}()},HB89:function(e,t,i){"use strict";var n=i("6blF"),r=i("T1DM"),a=i("Gi3i");n.a.prototype.debounceTime=function(e,t){return void 0===t&&(t=r.a),Object(a.a)(e,t)(this)}},JQ8u:function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i("gIcY"),r=i("klSw"),a=(i("sA4U"),i("Wy0B")),o=i("wd8w"),s=function(){function e(e){this._userGroupRest=e,this.allowToChangeId=!0,this.priorityLabels=a.j.filter(function(e){return e.length>0}),this.allUserGroups=this._userGroupRest.getAllUserGroups().pipe(Object(r.a)(1))}return Object.defineProperty(e.prototype,"orderForm",{set:function(e){this.f=e},enumerable:!0,configurable:!0}),e.createForm=function(e,t){var i=new n.j({Id:new n.g(void 0,[n.y.required]),CustomerName:new n.g(void 0,[]),CustomerPhone:new n.g(void 0,[n.y.pattern(o.e)]),CustomerEmail:new n.g(void 0,[n.y.pattern(o.a)]),Priority:new n.g(2),UserGroup:new n.g({value:void 0,disabled:!t},[]),VehicleRestriction:new n.g(void 0,[]),VehicleId:new n.g({value:"",disabled:!0},[])});return i.patchValue(e),i},e}()},PVOQ:function(e,t,i){"use strict";var n=i("UTJH"),r=i("mCK3"),a=i("IlA0"),o=i("K160"),s=i("Tjpy"),c=Object(s.a)(function(e,t){return null==e?{}:function(e,t){return function(e,t,i){for(var o=-1,s=t.length,c={};++o<s;){var l=t[o],u=Object(n.a)(e,l);i(0,l)&&Object(r.a)(c,Object(a.a)(l,e),u)}return c}(e,t,function(t,i){return Object(o.a)(e,i)})}(e,t)}),l=i("crfB"),u=i("cPJV"),d=i("sA4U"),h=i("GgTk");i.d(t,"a",function(){return p});var p=function(){function e(e,t){var i=this;this._dialogRef=e,this._data=t,this._preserveInitialRoutes=!1,this.vehicles=[],this.selectedVehicles=[],this.requiredVehicles=[],this.orders=[],this.selectedOrders=[],this.title="Optimization",this.elements=[[]],this.form={},this.tableOrderActions=[{label:"Due Time Filter",menuTemplateRef:function(){return i._timeFilterMenu}}],this.selectedIndex=0,this.tableHeight=window.innerHeight-110}return e.prototype.ngOnInit=function(){var e=this;if(console.log("VrpOptimizationSettingsDialogComponent -> ngOnInit -> this._data",this._data),this.vehicleColumns=this._data.config.vehicleColumns||h.e.vehicles,this.orderColumns=this._data.config.orderColumns||h.c,this._optimizationConfig=this._data.config.optimizationConfig||h.b,this.orders=this._data.selectableOrders,this.vehicles=this._data.selectableVehicles,this._data.initialSol){var t=this._data.turnOverTime,i=this._data.initialSol;isNaN(t)?this._preserveInitialRoutes=!0:this.title="Optimization - Vehicle Start Time derived from Solution "+i.id;var n=[],r=[];i.routes.forEach(function(i){var a=e.vehicles.find(function(e){return e.id===i.vehicle_id});a&&(isNaN(t)||(a.earliest_start=u(l(i.end_time,t),"YYYY-MM-DDTHH:mm:ssZ")),n.push(a.id)),r.push.apply(r,i.act.map(function(e){return e.job_id}))}),this.orders=this._data.selectableOrders.filter(function(e){return!r.includes(e.id)}),this._preserveInitialRoutes&&(this.requiredVehicles=this._data.selectableVehicles.filter(function(e){return n.includes(e.id)}))}this._selectAllOrdersAndVehicles(),this._initSettingsForm()},e.prototype.onResize=function(e){void 0===e&&(e=void 0),this.tableHeight=window.innerHeight-205},e.prototype.close=function(){var e=this,t=this._optimizationConfig.filter(function(t){return e.form[t.name]}),i=c(this.form,t.filter(function(e){return!e.isConstraint}).map(function(e){return e.name}));i.constraints=t.filter(function(e){return e.isConstraint}).map(function(e){return e.name}).join("_"),i.problem=this._createAbstractInstance(),this._preserveInitialRoutes&&(i.dynamicSettings="siwei"===i.engine?{initialSolIndex:0,mode:3}:{initialSolId:this._data.initialSol.id}),console.log("VrpOptimizationSettingsDialogComponent -> close -> options",i),this._dialogRef.close(i)},e.prototype.cancel=function(){this._dialogRef.close()},e.prototype.applyDueTimeFilter=function(e){this.selectedOrders=d.c.applyFilterToDateColumn(this.orders,"dueTime",e),this._orderTable.filter(this.selectedOrders),this.tableOrderActions[0].label="Filtered ("+e.start+" to  "+e.end+") "},e.prototype._selectAllOrdersAndVehicles=function(){this.selectedOrders=this.orders.slice(),this.selectedVehicles=this.vehicles.slice()},e.prototype._initSettingsForm=function(){var e=this,t=!(!this._data.initialSol&&!this._data.turnOverTime),i=[[]];if(this._optimizationConfig.forEach(function(n){var r=Object.assign({},n);if(!t||!r.hideForDynamic){e.form[r.name]=r.default;var a=n.rowIndex&&n.rowIndex>0?n.rowIndex:0;i[a]||(i[a]=[]),i[a].push(r)}}),!this.form.solutionId){var n=new Date;this.form.solutionId="s_"+n.YYMMDD()+"_"+n.HHmmss("")}this.elements=i},e.prototype._createAbstractInstance=function(){var e=this._data.problem,t=this.selectedOrders.map(function(e){return e.id}),i=this.selectedVehicles.map(function(e){return e.id}),n=Object.assign({vehicles:this.vehicles.filter(function(e){return i.includes(e.id)}),services:e.services.filter(function(e){return e&&t.includes(e.id)}),shipments:e.shipments.filter(function(e){return e&&t.includes(e.id)})},c(this._data.problem,["_id","coord_mode","fleet_size","items","username"])),r=n.vehicles.map(function(e){return e.type_id});n.vehicle_types=e.vehicle_types.filter(function(e){return r.includes(e.id)});var a=[];return n.vehicles.concat(n.services,n.shipments).forEach(function(e){["start_address","end_address","address","pickup_address"].forEach(function(t){e[t]&&e[t].id&&a.push(e[t].id)})}),n.addresses=e.addresses.filter(function(e){return e&&a.includes(e.id)}),this._preserveInitialRoutes&&(n.solutions=[this._data.initialSol]),console.log(" VrpOptimizationSettingsDialogComponent -> private_createAbstractInstance -> _p",n),n},e}()},QaIH:function(e,t,i){"use strict";i.d(t,"a",function(){return l});var n=i("gIcY"),r=i("klSw"),a=(i("HB89"),i("7EGn")),o=i("sA4U"),s=i("wd8w"),c=(i("auuj"),i("D8hx"),i("Rf/f"),i("Wy0B")),l=function(){function e(e,t,i,a,l,u,d){var h=this;this._dialogRef=e,this._plannerRest=t,this._geocode=i,this._userGroupRest=a,this._toast=l,this._authentication=u,this.data=d,this._subcriptions=[],this.createNew=!0,this.isPowerPlanner=!1,this.plateNumberMaxLength=c.i,this.allVehicleTypes=[],this.allUserGroups=[],this.enabledDrivers=[],this.filteredPostals=[],this._coords={},console.log("PlannerVehicleDetailDialogComponent -> constructor -> this.data.driverUsers",this.data.driverUsers),this.enabledDrivers=this.data.driverUsers.filter(function(e){return!e.disabled}),this.f=new n.j({Id:new n.g("VehicleA",[n.y.required,n.y.pattern(s.c)]),VehicleTypeId:new n.g(void 0,[n.y.required]),PlateNumber:new n.g("XXXXXX",[n.y.pattern(c.h)]),StartTime:new n.g("08:00"),EndTime:new n.g("20:00"),DriverUsername:new n.g(void 0),ReturnToEndAddress:new n.g(!1),UserGroup:new n.g(void 0),MaxNumJobs:new n.g(1e3,[n.y.min(1)]),StartAddressPostal:new n.g("",[n.y.required,n.y.minLength(6),n.y.pattern(s.f)],[o.d.postalExistValidator(this._geocode,function(e){return h._setCoords("Start",e)})]),EndAddressPostal:new n.g("",[n.y.required,n.y.minLength(6),n.y.pattern(s.f)],[o.d.postalExistValidator(this._geocode,function(e){return h._setCoords("End",e)})])}),d.value&&(this.createNew=!1,this.f.patchValue(d.value),["StartAddressLat","StartAddressLng","EndAddressLat","EndAddressLng"].forEach(function(e){h._coords[e]=d.value[e]})),this.vehicle=d.value,this.isPowerPlanner=d.isPowerPlanner,this.allVehicleTypes=this._plannerRest.getVehicleTypes().pipe(Object(r.a)(1)),this.allUserGroups=this._userGroupRest.getAllUserGroups().pipe(Object(r.a)(1))}return e.prototype.ngOnInit=function(){var e=this;this._subcriptions=[this.f.controls.StartAddressPostal.valueChanges.debounceTime(500).subscribe(function(t){return e._searchPostal(t)}),this.f.controls.EndAddressPostal.valueChanges.debounceTime(500).subscribe(function(t){return e._searchPostal(t)})]},e.prototype.ngOnDestroy=function(){this._subcriptions.forEach(function(e){return e.unsubscribe()})},e.prototype.save=function(e,t){var i=this;t&&(e.DriverUsername||(e.DriverUsername=null),e.UserGroup||(e.UserGroup=null),["StartAddressLat","StartAddressLng","EndAddressLat","EndAddressLng"].forEach(function(t){i._coords[t]&&(e[t]=i._coords[t])}),this.isPowerPlanner||(e.UserGroup=this._authentication.getUserGroup()),this.createNew?this._plannerRest.create(e,"Vehicle").subscribe(function(e){i._dialogRef.close()},function(e){return i._toast.shortAlert("Create Error",e)}):this._plannerRest.update(Object.assign({},this.vehicle,e),"Vehicle").subscribe(function(e){i._dialogRef.close()},function(e){return i._toast.shortAlert("Update Error",e)}))},e.prototype._searchPostal=function(e){var t=this;this._geocode.searchAddress(e).subscribe(function(e){return t.filteredPostals=e})},e.prototype._setCoords=function(e,t){this._coords[e+"AddressLat"]=Object(a.a)(t,"lat"),this._coords[e+"AddressLng"]=Object(a.a)(t,"lon")},e}()},Tjpy:function(e,t,i){"use strict";var n=i("uT1x"),r=function(e){return null!=e&&e.length?Object(n.a)(e,1):[]},a=i("UA7w"),o=i("xhnO");t.a=function(e){return Object(o.a)(Object(a.a)(e,void 0,r),e+"")}},UKIU:function(e,t,i){"use strict";var n=i("za5F");i.d(t,"a",function(){return n.a})},Wy0B:function(e,t,i){"use strict";i.d(t,"m",function(){return r}),i.d(t,"c",function(){return a}),i.d(t,"j",function(){return o}),i.d(t,"l",function(){return s}),i.d(t,"o",function(){return c}),i.d(t,"f",function(){return l}),i.d(t,"e",function(){return u}),i.d(t,"b",function(){return d}),i.d(t,"k",function(){return h}),i.d(t,"g",function(){return p}),i.d(t,"n",function(){return m}),i.d(t,"d",function(){return f}),i.d(t,"i",function(){return b}),i.d(t,"h",function(){return y}),i.d(t,"a",function(){return _});var n=i("sA4U"),r=[void 0,"PENDING","LATE","ONTIME","UNSUCCESSFUL","EXPECTED LATE","UNASSIGNED",void 0,void 0,void 0,"PENDING","COMPLETED","UNASSIGNED"],a=[2,3,4],o=["","LOW","MEDIUM","HIGH"],s=[{primary:"",secondary:""},{primary:"#1e90ff",secondary:"#D1E8FF",color:"blue",textColor:"white"},{primary:"#d77823",secondary:"#d77823",color:"orange",textColor:"white"},{primary:"#62f442",secondary:"#62f442",color:"green"},{primary:"#ad2121",secondary:"#FAE3E3",color:"red",textColor:"white"},{primary:"#b83dba",secondary:"#b83dba",color:"magenta",textColor:"white"},{primary:"#585858",secondary:"#585858",color:"grey",textColor:"white"}],c=["Vehicle Id","Job Sequence","Job Id","Job Type","Address","Contact Name","Start Time","End Time","Actual Delivery Time","Status"],l=Object(n.e)([{name:"id",label:"ID",type:"text"},{name:"type_id",label:"Type",type:"select",source_data_id:"vehicle_types"},{name:"driver_name",label:"Driver Name",type:"text"},{name:"earliest_start",label:"Start Time",type:"dateTime"},{name:"latest_end",label:"End Time",type:"dateTime"},{name:"num_assigned",label:"Number of Assigned Orders",type:"number",hidden:!0},{name:"max_num_job",label:"Maximum Allowed Orders",type:"number",hidden:!0},{name:"start_address",label:"Start Address",type:"address",width:{min:100,max:400},rowIndex:1,hidden:!0},{name:"end_address",label:"End Address",type:"address",width:{min:100,max:400},rowIndex:1,hidden:!0},{name:"return_to_depot",label:"Return",type:"boolean",width:80,rowIndex:1,hidden:!0}]),u=Object(n.e)([{name:"id",label:"Id",type:"text"},{name:"name",label:"Customer",type:"text"},{name:"type",label:"Type",type:"text",toUpperCase:!0},{name:"dueTime",label:"Due Time",type:"dateTime"},{name:"pickupDue",label:"Pickup Due",type:"dateTime"},{name:"deliveryDue",label:"Delivery Due",type:"dateTime"},{name:"priority",label:"Priority",type:"text",valueLabels:o},{name:"status",label:"Status",type:"text",valueLabels:r}]),d=Object(n.e)([{name:"Address",label:"Address",type:"text"},{name:"Postal",label:"Postal",type:"text"},{name:"StartTimeWindow",label:"Start Time Window",type:"dateTime"},{name:"DeliveryMasterId",label:"Order ID",type:"text",width:{min:200,max:300}},{name:"JobType",label:"Job Type",type:"text"},{name:"EndTimeWindow",label:"Due Time",type:"dateTime"},{name:"Status",label:"Status",type:"text",valueLabels:r},{name:"UserGroup",label:"UserGroup",type:"text"},{name:"_itemActions",label:"",width:80,hiddenExcel:!0}]),h=Object(n.e)({Order:[{name:"Id",label:"OrderId",type:"text",width:300},{name:"CustomerName",label:"CustomerName",type:"text",hidden:!0},{name:"CustomerPhone",label:"CustomerPhone",hidden:!0},{name:"CustomerEmail",label:"CustomerEmail",type:"text",hidden:!0},{name:"VehicleRestriction",label:"VehicleRestriction",type:"text",hidden:!1,toUpperCase:!0},{name:"Priority",label:"Priority",type:"text",valueLabels:o,fraction:0},{name:"JobType",label:"JobType",widthExcel:12,width:{min:50,max:100},toUpperCase:!0},{name:"Address",label:"Address",type:"text",widthExcel:20,hidden:!0},{name:"Postal",label:"Postal",type:"text"},{name:"Lat",label:"Lat",type:"number",fraction:3,hidden:!0},{name:"Lng",label:"Lng",type:"number",fraction:3,hidden:!0},{name:"StartTimeWindow",label:"StartTimeWindow",type:"dateTime",hidden:!0},{name:"EndTimeWindow",label:"EndTimeWindow",type:"dateTime",hidden:!0},{name:"ServiceTime",label:"ServiceTime",type:"number",hidden:!0},{name:"ContactName",label:"ContactName",widthExcel:16,width:{min:100,max:200}},{name:"ContactPhone",label:"ContactPhone",type:"text",hidden:!1,widthExcel:16,width:{min:100,max:100}},{name:"VerificationCode",label:"VerificationCode",type:"text"},{name:"Note",label:"Note",type:"text",hidden:!1,widthExcel:16},{name:"UserGroup",label:"UserGroup",type:"text"}],DeliveryMaster:[{name:"Id",label:"OrderId"},{name:"CustomerName",label:"CustomerName"},{name:"CustomerPhone",label:"CustomerPhone"},{name:"CustomerEmail",label:"CustomerEmail",type:"text"},{name:"VehicleRestriction",label:"VehicleRestriction",type:"text"},{name:"Priority",label:"Priority",type:"number",fraction:0}],DeliveryDetail:[{name:"DeliveryMasterId",label:"Order Id",widthExcel:20,width:{min:100,max:200}},{name:"JobType",label:"Job Type",widthExcel:12,width:{min:50,max:100}},{name:"Address",label:"Address",type:"text",widthExcel:20},{name:"Postal",label:"Postal",type:"text",hidden:!0},{name:"StartTimeWindow",label:"StartTimeWindow",type:"dateTime",hidden:!0},{name:"EndTimeWindow",label:"EndTimeWindow",type:"dateTime",hidden:!0},{name:"ServiceTime",label:"ServiceTime",type:"number",hidden:!0},{name:"Status",label:"Job Status",type:"text",valueLabels:r,widthExcel:12,hidden:!1},{name:"ContactName",label:"ContactName",widthExcel:16,width:{min:50,max:200}},{name:"DeliveryMaster.CustomerName",label:"CustomerName",type:"text",hidden:!0},{name:"DeliveryMaster.CustomerPhone",label:"CustomerPhone",hidden:!0},{name:"DeliveryMaster.CustomerEmail",label:"CustomerEmail",type:"text",hidden:!0},{name:"ContactPhone",label:"ContactPhone",type:"text",widthExcel:16,width:{min:50,max:100}},{name:"Priority",label:"Priority",type:"text",valueLabels:o,widthExcel:8,width:{min:50,max:100}},{name:"VerificationCode.Code",label:"Verification Code",widthExcel:16,width:{min:50,max:150},hidden:!0},{name:"VehicleRestriction",label:"VehicleRestriction",type:"text"},{name:"VehicleId",label:"AssignedTo",type:"text",hidden:!0},{name:"UserGroup",label:"UserGroup",type:"text",hidden:!0},{name:"_itemActions",label:"",width:90,hiddenExcel:!0}],DeliveryItem:[{name:"DeliveryMasterId",label:"OrderId"},{name:"ItemId",label:"ItemId"},{name:"ItemQty",label:"Quantity",type:"number",fraction:0}],Item:[{name:"Id",label:"ItemId",type:"text",widthExcel:12},{name:"Weight",label:"Weight",type:"number",fraction:3,widthExcel:12},{name:"Description",label:"Description",type:"text",widthExcel:16},{name:"_itemActions",label:"",width:80,hiddenExcel:!0,sortable:!1}],VehicleType:[{name:"Name",label:"Name",widthExcel:8,type:"text",toUpperCase:!0},{name:"Capacity",label:"Capacity",widthExcel:12,type:"number"},{name:"FixedCost",label:"FixedCost",widthExcel:14,type:"number",fraction:3},{name:"DistanceCost",label:"DistanceCost",widthExcel:20,type:"number",fraction:3},{name:"TravelTimeCost",label:"TravelTimeCost",widthExcel:20,type:"number",fraction:3},{name:"WaitingTimeCost",label:"WaitingTimeCost",widthExcel:20,type:"number",fraction:3},{name:"_itemActions",label:"",width:80,hiddenExcel:!0}],Vehicle:[{name:"Id",label:"VehicleId",widthExcel:16,type:"text",toUpperCase:!0},{name:"VehicleType.Name",label:"VehicleType",widthExcel:12,type:"text",toUpperCase:!0},{name:"DriverUsername",label:"Driver",widthExcel:14,type:"text"},{name:"PlateNumber",label:"PlateNumber",widthExcel:14,type:"text",hidden:!0},{name:"StartAddressPostal",label:"StartPostal",widthExcel:10,rowIndex:1,type:"text",hidden:!0},{name:"EndAddressPostal",label:"EndPostal",widthExcel:10,rowIndex:1,type:"text",hidden:!0},{name:"StartTime",label:"StartTime",widthExcel:10,rowIndex:2,type:"time"},{name:"EndTime",label:"EndTime",widthExcel:10,rowIndex:2,type:"time"},{name:"ReturnToEndAddress",label:"ReturnToDepot",widthExcel:10,rowIndex:2,type:"boolean"},{name:"MaxNumJobs",label:"MaxNumJobs",widthExcel:10,rowIndex:1,type:"number",hidden:!0},{name:"UserGroup",label:"UserGroup",type:"text"},{name:"_itemActions",label:"",width:80,hiddenExcel:!0}]}),p=Object(n.e)([{name:"VehicleId",label:"Id",widthExcel:16,type:"text"},{name:"DeliveryMasterId",label:"OrderId"},{name:"JobType",label:"JobType",widthExcel:12,width:{min:50,max:100}},{name:"arr_time",label:"Arrival Time",type:"text"},{name:"end_time",label:"Leave Time",type:"text"},{name:"distance",label:"Distance (km)",type:"text"},{name:"waiting_time",label:"Free Time (min)",type:"text"},{name:"Priority",label:"Priority",type:"text",valueLabels:o},{name:"Postal",label:"LocationId",type:"number",fraction:0},{name:"StartTimeWindow",label:"Ready Time",type:"dateTime"},{name:"EndTimeWindow",label:"Due Time",type:"dateTime"}]),m=Object(n.e)([{name:"DeliveryMasterId",label:"Order Id",widthExcel:16},{name:"JobType",label:"Job Type",widthExcel:12},{name:"Status",label:"Job Status",type:"text",valueLabels:r,widthExcel:12},{name:"ActualDeliveryTime",label:"Delivery Time",type:"dateTime",dateFormat:"MM/DD/YY HH:mm",widthExcel:25},{name:"ContactName",label:"Customer Name",widthExcel:20},{name:"DeliveryMaster.LastAttemptedByDriver",label:"Attempted By",type:"text",widthExcel:20},{name:"DeliveryMaster.LastAttemptedByPlateNumber",label:"Driver's Plate Number",type:"text",widthExcel:20,width:{min:200,max:300}},{name:"_itemActions",label:"",width:90,hiddenExcel:!0}]),f=[{name:"solutionId",label:"Solution Id",type:"text"},{name:"engine",label:"Algorithm",type:"select",selectionLabels:["Memetic Algorithm","Hybrid Improvement"],selections:["siwei","chinh"],default:"chinh"},{name:"costModel",label:"Cost Model",type:"select",selectionLabels:["Default","Shanghai"],selections:["default","shanghai"],default:"default",readonly:!0},{name:"nThreads",label:"No. CPUs",type:"number",default:4,min:1,max:8},{name:"maxIterations",label:"Max. Iteration",type:"number",default:1e3,min:1,rowIndex:1},{name:"minJobPenalty",label:"*Min. Job Penalty",type:"number",default:.3,min:0,rowIndex:1},{name:"maxRunningTime",label:"Max. Time (minutes)",type:"number",default:5,min:1,rowIndex:1},{name:"measureService",label:"Measure Service",type:"select",selections:["osmap","gmap"],selectionLabels:["Open Street Map","Google Map"],default:"osmap",rowIndex:1,readOnly:!0},{name:"enableMinJobPenalty",label:"*Enable assignment balancing (min job)",type:"checkbox",default:!0,rowIndex:5},{name:"sortByVehicleId",label:"*Sort solution by vehicle id",type:"checkbox",default:!0,rowIndex:5,hideForDynamic:!0},{name:"capacity",label:"Maximum Capacity Constraint",type:"checkbox",default:!0,rowIndex:2,isConstraint:!0},{name:"timeWindow",label:"Time-Window Constraint",type:"checkbox",default:!0,rowIndex:2,isConstraint:!0},{name:"restrictJobsToSpecificVehicles",label:"Restrict jobs to specific vehicles",type:"checkbox",default:!0,rowIndex:3,isConstraint:!0},{name:"priorityJob",label:"Prioritize jobs",type:"checkbox",default:!0,rowIndex:3,isConstraint:!0},{name:"completedBeforeDueTime",label:"Complete jobs before due time",type:"checkbox",default:!0,rowIndex:4,isConstraint:!0},{name:"maxNumJob",label:"*Limit number of jobs per vehicle",type:"checkbox",default:!0,rowIndex:4,isConstraint:!0}],b=10,y=/^[A-Za-z0-9-]+$/,v={ContactName:"Test",ContactPhone:"12345678",ContactEmail:"sample@gmail.com",Status:1,VerificationCode:void 0,StartTimeWindow:(new Date).setHours(8,0,0),EndTimeWindow:(new Date).setHours(18,0,0),ServiceTime:10,DeliveryItems:[]},g=Object.assign({JobType:"PICKUP",JobSequence:1,Address:"OneNorth MRT",Postal:"138647",Lat:1.299854,Lng:103.787437},v),D=Object.assign({JobType:"DELIVERY",JobSequence:2,Address:"Clementi MRT",Postal:"129580",Lat:1.315676,Lng:103.765009},v),_={CustomerName:"Sample Customer",CustomerPhone:"12345678",CustomerEmail:"sample@gmail.com",Priority:2,VehicleRestriction:void 0,DeliveryDetails:[Object.assign({},g),Object.assign({},D)]}},aS0w:function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i("+dGY");var n=i("2WpN"),r=i("WmBB"),a=i("CXhC"),o=i("1vin"),s=i("lCuP"),c=i("Wy0B"),l=(i("auuj"),function(){function e(e,t,i){this._loading=e,this._plannerRest=t,this.data=i,this.cancelButton="CLOSE",this.acceptButton="SELECT",this.events=[],this.viewDate=new Date,this.viewDate=new Date(this.data.viewDate),this._loadMonthData(!0)}return e.prototype.dayClicked=function(e){this.selectedDate=e.date},e.prototype.changeMonth=function(e){r(e,this.viewDate)||(this.viewDate=e,this._loadMonthData(!0))},e.prototype._loadMonthData=function(e){var t=this;void 0===e&&(e=!1),this._loading.register("planner-date-selection.load"),this._plannerRest.getSummary(s(this.viewDate),o(this.viewDate),e).pipe(Object(n.a)(function(){return t._loading.resolve("planner-date-selection.load")})).subscribe(function(e){t.events=[],e.forEach(function(e){var i=new Date(e.date);e.numJobsByStatus.sort(function(e,t){return e.status-t.status}).forEach(function(e){if(0!==e.count){var n={title:e.count+" "+c.m[e.status],shortTitle:e.count,start:a(i),allDay:!0,color:c.l[e.status]};t.events.push(n)}})})},function(e){console.error(e)})},e}())},auuj:function(e,t,i){"use strict";i.d(t,"a",function(){return d});var n=i("Ip0R"),r=i("67Y/"),a=i("xMyE"),o=i("m8R6"),s=i("sA4U"),c=i("uqu0"),l=i("CcnG"),u=i("t/Na"),d=function(){function e(e,t){this._http=e,this._baseUrl=t,this._datePipe=new n.e("en-US"),s.b.http=this._http}return e.prototype.findInCachedData=function(e){return s.b.getCacheData(e)},e.prototype.getSummary=function(e,t,i){void 0===i&&(i=!1);var n=this._baseUrl+"/v2.1/misc/summary?"+this._getDateRange(e,t);return s.b.get(n,i).pipe(Object(r.a)(function(e){return e}))},e.prototype.queryDeliveryMasters=function(e,t,i,n){void 0===t&&(t=void 0),void 0===i&&(i=void 0),void 0===n&&(n=!1);var r=i?"where="+JSON.stringify(i)+"&":"",a=this._baseUrl+"/v2.1/order?"+r+this._getDateRange(e,t);return s.b.get(a,n,{tableName:"DeliveryMaster",startDate:e,endDate:t})},e.prototype.getDeliveryMaster=function(e,t){return void 0===t&&(t=!1),s.b.get(this._baseUrl+"/v2.1/order/"+e,t,{tableName:"DeliveryMaster",orderId:e})},e.prototype.getDeliveryDetails=function(e,t,i,n){void 0===t&&(t=void 0),void 0===i&&(i=void 0),void 0===n&&(n=!1);var r=i?"where="+JSON.stringify(i)+"&":"",o=this._baseUrl+"/v2.1/job?"+r+this._getDateRange(e,t);return s.b.get(o,n,{tableName:"DeliveryDetail",startDate:e,endDate:t}).pipe(Object(a.a)(function(e){e.forEach(function(e){var t=e.DeliveryMaster;e.JobProp=t.DeliveryDetails&&t.DeliveryDetails.length>=2?"SHIPMENT":"SERVICE",e.VehicleId=t.VehicleId,e.Priority=t.Priority,e.VehicleRestriction=t.VehicleRestriction,e.UserGroup=t.UserGroup})}))},e.prototype.getVehicles=function(e,t){void 0===e&&(e=void 0),void 0===t&&(t=!1);var i=this._baseUrl+"/v2.1/vehicle";return e&&(i+="?where="+JSON.stringify({Id:e})),s.b.get(i,t,{tableName:"Vehicle"})},e.prototype.getItems=function(e){return void 0===e&&(e=!1),s.b.get(this._baseUrl+"/v2.1/item",e,{tableName:"Item"})},e.prototype.getTransactionLogFile=function(e,t,i){void 0===t&&(t=void 0),void 0===i&&(i=!1);var n=this._baseUrl+"/v2.1/files/transactionLog?withPhotos="+i+"&"+this._getDateRange(e,t);return this._http.get(n,{responseType:"blob"})},e.prototype.approvePlan=function(e){return this._http.put(this._baseUrl+"/v2.1/plan",{solution:e})},e.prototype.getPOD=function(e){return s.b.get(this._baseUrl+"/v2.1/pod/"+e)},e.prototype.getDeliveryNote=function(e){return s.b.get(this._baseUrl+"/v2.1/note/"+e)},e.prototype.getVehicleTypes=function(e){return void 0===e&&(e=!1),s.b.get(this._baseUrl+"/v2.1/vehicleType",e)},e.prototype.optimize=function(e,t,i,n){var r=e.map(function(e){return e.Id}).join(","),a=t.map(function(e){return e.Id}).join(","),o=Object.keys(n).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&"),s=this._baseUrl+"/v2.1/plan/optimize?vehicleIds="+a+"&orderIds="+r+"&date="+this._getISODateString(i)+"&"+o;return this._http.get(s)},e.prototype.update=function(e,t){var i,n={newValues:Object(o.a)(e,["Id"])};switch(t){case"DeliveryMaster":i=this._baseUrl+"/v2.1/order/"+e.Id;break;case"DeliveryDetail":i=this._baseUrl+"/v2.1/job/"+e.Id;break;case"DeliveryItem":i=this._baseUrl+"/v2.1/jobItem/"+e.Id;break;case"Item":i=this._baseUrl+"/v2.1/item/"+e.Id;break;case"VehicleType":i=this._baseUrl+"/v2.1/vehicleType/"+e.Id;break;case"Vehicle":i=this._baseUrl+"/v2.1/vehicle/"+e.Id}return console.debug("update",t,n),this._http.put(i,n)},e.prototype.create=function(e,t,i){var n;switch(void 0===i&&(i="undefined"),t){case"DeliveryMaster":n=this._baseUrl+"/v2.1/order";break;case"DeliveryDetail":n=this._baseUrl+"/v2.1/job";break;case"DeliveryItem":n=this._baseUrl+"/v2.1/job/"+i+"/item";break;case"Item":n=this._baseUrl+"/v2.1/item";break;case"VehicleType":n=this._baseUrl+"/v2.1/vehicleType",e=e instanceof Array?e.map(function(e){return Object(o.a)(e,["Id"])}):Object(o.a)(e,["Id"]);break;case"Vehicle":n=this._baseUrl+"/v2.1/vehicle";break;default:alert("That should not happen")}return this._http.post(n,{record:e})},e.prototype.deleteMany=function(e,t){var i;switch(t){case"DeliveryMaster":i=this._baseUrl+"/v2.1/order/destroy";break;case"DeliveryDetail":i=this._baseUrl+"/v2.1/job/destroy";break;case"DeliveryItem":return i=this._baseUrl+"/v2.1/jobItem/destroy",void alert("Destroy API for DeliveryItems are not applicable");case"Item":i=this._baseUrl+"/v2.1/item/destroy";break;case"VehicleType":i=this._baseUrl+"/v2.1/vehicleType/destroy";break;case"Vehicle":i=this._baseUrl+"/v2.1/vehicle/destroy";break;default:alert("That should not happen")}return this._http.post(i,{ids:e})},e.prototype.deleteDeliveryItemsOfJob=function(e){return this._http.delete(this._baseUrl+"/v2.1/job/"+e+"/item")},e.prototype.replaceDeliveryItemsOfJob=function(e,t){return this._http.put(this._baseUrl+"/v2.1/job/"+e+"/item",{record:t})},e.prototype.getVerificationCode=function(e){return this._http.get(this._baseUrl+"/v2.1/code/"+e)},e.prototype.createVerificationCode=function(e,t){return this._http.post(this._baseUrl+"/v2.1/code/"+e,{record:{Code:t}})},e.prototype.updateVerificationCode=function(e,t){return this._http.put(this._baseUrl+"/v2.1/code/"+e,{newValues:{Code:t}})},e.prototype.deleteVerificationCode=function(e){return this._http.delete(this._baseUrl+"/v2.1/code/"+e)},e.prototype.notify=function(e){return this._http.post(this._baseUrl+"/v2.1/code/"+e.jobId+"/notify",{record:e})},e.prototype.getProblemJson=function(e,t){void 0===t&&(t=!0);var i=this._baseUrl+"/v2.1/plan/problem?"+this._getDateRange(e);return s.b.get(i,t).pipe(Object(r.a)(function(e){return new c.a(e)}))},e.prototype.getExcelTemplate=function(){return this._http.get(this._baseUrl+"/v2.1/files/template",{responseType:"blob"})},e.prototype.getVehicleLastLocation=function(){return this._http.get(this._baseUrl+"/v2.1/vehicleLog/last")},e.prototype._getDateRange=function(e,t){return void 0===t&&(t=void 0),e?t?"startDate="+this._getISODateString(e)+"&endDate="+this._getISODateString(t):"date="+this._getISODateString(e):""},e.prototype._getISODateString=function(e){return this._datePipe.transform(e,"yyyy-MM-dd")},e.ngInjectableDef=l.T({factory:function(){return new e(l.X(u.c),l.X("PLANNER_REST_BASE_URL"))},token:e,providedIn:"root"}),e}()},bri6:function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i("CcnG"),r=i("t/Na"),a=function(){function e(e,t){this._http=e,this._baseUrl=t}return e.prototype.getAll=function(e,t){return this._http.get(this._baseUrl+"/v2?startDate="+e.toISODate()+"&endDate="+t.toISODate())},e.prototype.process=function(e){return this._http.put(this._baseUrl+"/v2/process/"+e._id,{})},e.prototype.getUnprocessedMessagesCount=function(){return this._http.get(this._baseUrl+"/v2/unprocessedCount")},e.ngInjectableDef=n.T({factory:function(){return new e(n.X(r.c),n.X("MESSAGE_REST_BASE_URL"))},token:e,providedIn:"root"}),e}()},cmJY:function(e,t,i){"use strict";i.d(t,"a",function(){return u});var n=i("Wy0B"),r=i("l0SJ"),a=i("/Tkk"),o=i("9WoD"),s=i("CXhC"),c=i("7EGn"),l=i("Olm7"),u=function(){function e(){}return e.updateItemsToArray=function(e,t){var i=[];return e.forEach(function(e){if(e){var n=t.find(function(t){return t.Id===e.Id});n?(Object.assign(n,e),i.push(n)):(t.push(e),i.push(e))}}),i},e.removeItemsFromArray=function(e,t){return Object(l.a)(t,function(t){return e.includes(t.Id)})},e.updateCreateAndRemoveAccordingToWS=function(t,i){var n=[];return["update","create","attempted"].includes(t.purpose)?n=e.updateItemsToArray(t.data,i):"delete"===t.purpose&&(n=e.removeItemsFromArray(t.data,i)),n},e.containFinishedJob=function(t){return!t.every(function(t){return!e.isJobFinished(t)})},e.isJobFinished=function(e){return n.c.includes(e.Status)},e.isJobDelivery=function(e){return"DELIVERY"===e.JobType.toUpperCase()},e.isJobPickup=function(e){return"PICKUP"===e.JobType.toUpperCase()},e.isLatLngInSingapore=function(e,t){return!(!e||!t)&&1.206622<e&&e<1.481204&&103.580887<t&&t<104.053299},e.isSameUserGroup=function(e,t){return!e.UserGroup&&!t.UserGroup||!(!e.UserGroup||!t.UserGroup)&&e.UserGroup.toUpperCase()===t.UserGroup.toUpperCase()},e.isFilterPassed=function(e,t){return Object.keys(t).every(function(i){return Object.keys(t[i]).every(function(t,n){return"$sameDay"===t&&a(e[i],n)})})},e.isLatLngValid=function(e,t){return!isNaN(e)&&-90<e&&e<90&&!isNaN(t)&&-180<t&&t<180},e.filterArrayBySearchTerm=function(e,t,i,n){if(void 0===n&&(n=!0),!e)return t.map(function(e){return e});if(t&&t.length>0&&e){var r=n?e.toLowerCase():e;return console.log("term",r),t.filter(function(t){var r=i.map(function(e){return Object(c.a)(t,e,"")}).join(";");return console.log("str",r),-1!==(n?r.toLowerCase().search(e):r.search(e))})}return[]},e.isWithinDateRange=function(e,t,i){return o(e,s(t),r(i))},e}()},gUJA:function(e,t,i){"use strict";i.d(t,"a",function(){return n});var n=function(){}},"go+/":function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i("gIcY"),r=i("wd8w"),a=(i("auuj"),i("D8hx"),function(){function e(e,t,i,a){this._dialogRef=e,this._plannerRest=t,this._toast=i,this.createNew=!0,this.f=new n.j({Id:new n.g("ItemA",[n.y.required,n.y.pattern(r.c),this.checkIdExistence(a.allItemIds.map(function(e){return e.toUpperCase()}))]),Weight:new n.g(10,[]),Description:new n.g("Description",[])}),a.value&&(this.createNew=!1,this.f.patchValue(a.value)),this.item=a.value}return e.prototype.save=function(e,t){var i=this;t&&(this.createNew?this._plannerRest.create(e,"Item").subscribe(function(e){i._dialogRef.close()},function(e){return i._toast.shortAlert("Create Error",e)}):this._plannerRest.update(Object.assign({},this.item,e),"Item").subscribe(function(e){i._dialogRef.close()},function(e){return i._toast.shortAlert("Update Error",e)}))},e.prototype.checkIdExistence=function(e){var t=this;return function(i){return t.createNew&&i.value&&e.includes(i.value.toString().toUpperCase())?{existence:!0}:void 0}},e}())},jXxP:function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i("1CCG"),r=function(){function e(e,t){this._dialogRef=e,this.data=t,this.title="Select Date Range",this.cancelButton="CANCEL",this.acceptButton="SAVE",this.myDateRangePickerOptions={dateFormat:"mmm dd, yyyy",inline:!0,showApplyBtn:!1},this.dateRange={},this.maxDateRange=31,this.isRangeValid=!0,this.data.start&&(this.dateRange.beginJsDate=this.data.start,this.dateRange.beginDate={year:this.data.start.getFullYear(),month:this.data.start.getMonth()+1,day:this.data.start.getDate()}),this.data.end&&(this.dateRange.endJsDate=this.data.end,this.dateRange.endDate={year:this.data.end.getFullYear(),month:this.data.end.getMonth()+1,day:this.data.end.getDate()}),this.checkRange(this.dateRange)}return e.prototype.save=function(){this.isRangeValid&&this._dialogRef.close({startDate:this.dateRange.beginJsDate,endDate:this.dateRange.endJsDate})},e.prototype.checkRange=function(e){if(e){var t=n(e.endJsDate,e.beginJsDate);this.isRangeValid=t<this.maxDateRange}else this.isRangeValid=!1},e}()},k8aw:function(e,t,i){"use strict";i.d(t,"a",function(){return u});var n=i("CcnG"),r=i("gIcY"),a=i("cPJV"),o=i("7EGn"),s=(i("sA4U"),i("Wy0B")),c=i("qzux"),l=i("wd8w"),u=function(){function e(e){this._geocode=e,this._subcriptions=[],this.filteredPostals=[],this.statusLabels=s.m.slice(),this.readonly=!0,this.allowDeleteJob=!0,this.allowChangeJobType=!0,this.jobDelete=new n.m,this.selectedIndex=0}return Object.defineProperty(e.prototype,"jobForm",{set:function(e){this.f=e},enumerable:!0,configurable:!0}),e.createForm=function(e){var t=new r.g(void 0,[r.y.required]),i=new r.j({Id:new r.g(void 0,[]),ContactName:new r.g(void 0,[]),ContactPhone:new r.g(void 0,[]),ContactEmail:new r.g(void 0,[r.y.pattern(l.a)]),JobType:new r.g("PICKUP",[]),JobSequence:new r.g(0,[]),ServiceTime:new r.g(10,[r.y.required]),Address:new r.g(void 0,[]),Postal:new r.g("",[r.y.required,r.y.minLength(6),r.y.pattern(l.f)]),Lat:new r.g(void 0,[r.y.required,c.a.LatInSingapore]),Lng:new r.g(void 0,[r.y.required,c.a.LngInSingapore]),StartTimeWindow:t,EndTimeWindow:new r.g(void 0,[r.y.required,c.a.endTimeWindowValidator(t),c.a.timeWindowValidator(t)]),VerificationCode:new r.g(void 0,[]),NoteFromPlanner:new r.g([],[]),DeliveryItems:new r.g([],[c.a.arrayNotEmpty()]),ActualDeliveryTime:new r.g({value:void 0,disabled:!0},[]),Status:new r.g({value:void 0,disabled:!0},[])}),n=Object.assign({},e,{VerificationCode:Object(o.a)(e,"VerificationCode.Code"),StartTimeWindow:a(e.StartTimeWindow,"YYYY-MM-DDTHH:mm"),EndTimeWindow:a(e.EndTimeWindow,"YYYY-MM-DDTHH:mm"),ActualDeliveryTime:e.ActualDeliveryTime?a(e.ActualDeliveryTime,"YYYY-MM-DDTHH:mm"):void 0});return i.patchValue(n),i},e.prototype.ngOnInit=function(){var e=this,t=this.f.get("EndTimeWindow"),i=this.f.get("StartTimeWindow");i.setValidators([r.y.required,c.a.startTimeWindowValidator(t),c.a.timeWindowValidator(t)]),this._subcriptions=[this.f.get("Postal").valueChanges.debounceTime(500).subscribe(function(t){t.length>=4&&e._geocode.searchAddress(t).subscribe(function(i){e.filteredPostals=i,0===e.filteredPostals.length&&e.f.get("Postal").setErrors({nonexistence:!0}),6===t.length&&e.setCoords(t)},function(t){e.f.get("Postal").setErrors({serverError:!0})})}),i.valueChanges.debounceTime(500).subscribe(function(e){t.updateValueAndValidity()}),t.valueChanges.debounceTime(500).subscribe(function(e){i.updateValueAndValidity()})]},e.prototype.ngOnDestroy=function(){this._subcriptions.forEach(function(e){return e.unsubscribe()})},e.prototype.sendDeleteJobRequest=function(){this.jobDelete.emit(!0)},e.prototype.generateVerificationCode=function(){var e=this.f.get("VerificationCode");e&&(e.patchValue(Math.floor(89999*Math.random()+1e4)),e.markAsDirty())},e.prototype.setCoords=function(e){var t=Object(c.b)(e,this.filteredPostals);console.log("setCoords -> coords",e,t,this.filteredPostals),this.f.get("Lat").patchValue(t&&t.lat),this.f.get("Lng").patchValue(t&&t.lon)},e}()},klSw:function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i("S5bw");function r(e,t,i){return function(r){return r.lift(function(e,t,i){var r,a,o=0,s=!1,c=!1;return function(l){o++,r&&!s||(s=!1,r=new n.a(e,t,i),a=l.subscribe({next:function(e){r.next(e)},error:function(e){s=!0,r.error(e)},complete:function(){c=!0,r.complete()}}));var u=r.subscribe(this);return function(){o--,u.unsubscribe(),a&&0===o&&c&&a.unsubscribe()}}}(e,t,i))}}},m8R6:function(e,t,i){"use strict";var n=i("twO/"),r=i("oSzE"),a=i("23KU"),o=i("uE2L"),s=function(e,t,i,n){var r=!i;i||(i={});for(var s=-1,c=t.length;++s<c;){var l=t[s],u=n?n(i[l],e[l],l,i,e):void 0;void 0===u&&(u=e[l]),r?Object(o.a)(i,l,u):Object(a.a)(i,l,u)}return i},c=i("mkut"),l=i("7gMY"),u=i("IzLi"),d=i("pyRK"),h=Object.prototype.hasOwnProperty,p=i("5WsY"),m=function(e){return Object(p.a)(e)?Object(l.a)(e,!0):function(e){if(!Object(u.a)(e))return function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=Object(d.a)(e),i=[];for(var n in e)("constructor"!=n||!t&&h.call(e,n))&&i.push(n);return i}(e)},f=i("3/ER"),b=i("jN84"),y=i("tPH9"),v=i("U6JX"),g=Object(v.a)(Object.getPrototypeOf,Object),D=i("WJ6P"),_=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Object(y.a)(t,Object(b.a)(e)),e=g(e);return t}:D.a,w=i("TFwu"),I=i("25cm"),j=function(e){return Object(I.a)(e,m,_)},x=i("YM6B"),T=Object.prototype.hasOwnProperty,O=i("Ce4a"),C=function(e){var t=new e.constructor(e.byteLength);return new O.a(t).set(new O.a(e)),t},E=/\w*$/,S=i("ylTp"),U=S.a?S.a.prototype:void 0,P=U?U.valueOf:void 0,A=Object.create,R=function(){function e(){}return function(t){if(!Object(u.a)(t))return{};if(A)return A(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),V=i("/1FC"),M=i("WOAq"),N=i("EUcb"),J=i("ovuK"),k=i("xutz"),L=k.a&&k.a.isMap,W=L?Object(J.a)(L):function(e){return Object(N.a)(e)&&"[object Map]"==Object(x.a)(e)},G=k.a&&k.a.isSet,F=G?Object(J.a)(G):function(e){return Object(N.a)(e)&&"[object Set]"==Object(x.a)(e)},B={};B["[object Arguments]"]=B["[object Array]"]=B["[object ArrayBuffer]"]=B["[object DataView]"]=B["[object Boolean]"]=B["[object Date]"]=B["[object Float32Array]"]=B["[object Float64Array]"]=B["[object Int8Array]"]=B["[object Int16Array]"]=B["[object Int32Array]"]=B["[object Map]"]=B["[object Number]"]=B["[object Object]"]=B["[object RegExp]"]=B["[object Set]"]=B["[object String]"]=B["[object Symbol]"]=B["[object Uint8Array]"]=B["[object Uint8ClampedArray]"]=B["[object Uint16Array]"]=B["[object Uint32Array]"]=!0,B["[object Error]"]=B["[object Function]"]=B["[object WeakMap]"]=!1;var H=function e(t,i,n,o,l,h){var p,y=1&i,v=2&i,D=4&i;if(n&&(p=l?n(t,o,l,h):n(t)),void 0!==p)return p;if(!Object(u.a)(t))return t;var I=Object(V.a)(t);if(I){if(p=function(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&T.call(e,"index")&&(i.index=e.index,i.input=e.input),i}(t),!y)return function(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}(t,p)}else{var O=Object(x.a)(t),S="[object Function]"==O||"[object GeneratorFunction]"==O;if(Object(M.a)(t))return Object(f.a)(t,y);if("[object Object]"==O||"[object Arguments]"==O||S&&!l){if(p=v||S?{}:function(e){return"function"!=typeof e.constructor||Object(d.a)(e)?{}:R(g(e))}(t),!y)return v?function(e,t){return s(e,_(e),t)}(t,function(e,i){return e&&s(t,m(t),e)}(p)):function(e,t){return s(e,Object(b.a)(e),t)}(t,function(e,t){return e&&s(t,Object(c.a)(t),e)}(p,t))}else{if(!B[O])return l?t:{};p=function(e,t,i){var n,r,a=e.constructor;switch(t){case"[object ArrayBuffer]":return C(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return function(e,t){var i=t?C(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var i=t?C(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}(e,i);case"[object Map]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return(r=new(n=e).constructor(n.source,E.exec(n))).lastIndex=n.lastIndex,r;case"[object Set]":return new a;case"[object Symbol]":return P?Object(P.call(e)):{}}}(t,O,y)}}h||(h=new r.a);var U=h.get(t);if(U)return U;if(h.set(t,p),F(t))return t.forEach(function(r){p.add(e(r,i,n,r,t,h))}),p;if(W(t))return t.forEach(function(r,a){p.set(a,e(r,i,n,a,t,h))}),p;var A=D?v?j:w.a:v?keysIn:c.a,N=I?void 0:A(t);return function(r,o){for(var s=-1,c=null==r?0:r.length;++s<c&&!1!==(l=r[s],u=s,N&&(l=t[u=l]),void Object(a.a)(p,u,e(l,i,n,u,t,h))););var l,u}(N||t),p},Y=i("FUmc"),q=i("IlA0"),z=i("8M4i"),X=Function.prototype,Q=Object.prototype,K=X.toString,$=Q.hasOwnProperty,Z=K.call(Object),ee=function(e){return function(e){if(!Object(N.a)(e)||"[object Object]"!=Object(z.a)(e))return!1;var t=g(e);if(null===t)return!0;var i=$.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&K.call(i)==Z}(e)?void 0:e},te=i("Tjpy");t.a=Object(te.a)(function(e,t){var i={};if(null==e)return i;var r=!1;t=Object(n.a)(t,function(t){return t=Object(q.a)(t,e),r||(r=t.length>1),t}),s(e,j(e),i),r&&(i=H(i,7,ee));for(var a=t.length;a--;)Object(Y.a)(i,t[a]);return i})},nP1h:function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i("gIcY"),r=(i("HB89"),i("wd8w")),a=(i("auuj"),i("D8hx"),function(){function e(e,t,i,a){this._dialogRef=e,this._plannerRest=t,this._toast=i,this.createNew=!0,this.f=new n.j({Name:new n.g("TypeA",[n.y.required,n.y.pattern(r.c),this.checkIdExistence(a.allVehicleTypeNames.map(function(e){return e.toUpperCase()}))]),Capacity:new n.g(1e3,[]),FixedCost:new n.g(100,[]),DistanceCost:new n.g(1e-4,[]),TravelTimeCost:new n.g(.0017,[]),WaitingTimeCost:new n.g(.0017,[])}),a.value&&(this.createNew=!1,this.f.patchValue(a.value)),this.vehicleType=a.value}return e.prototype.save=function(e,t){var i=this;t&&(this.createNew?this._plannerRest.create(e,"VehicleType").subscribe(function(e){i._dialogRef.close()},function(e){return i._toast.shortAlert("Create Error",e)}):this._plannerRest.update(Object.assign({},this.vehicleType,e),"VehicleType").subscribe(function(e){i._dialogRef.close()},function(e){return i._toast.shortAlert("Update Error",e)}))},e.prototype.checkIdExistence=function(e){var t=this;return function(i){return t.createNew&&i.value&&e.includes(i.value.toString().toUpperCase())?{existence:!0}:void 0}},e}())},pLIX:function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i("/Tkk"),r=i("cmJY"),a=i("Wy0B"),o=function(){function e(e){this.startDate=e.startDate,this.endDate=e.endDate,this.finishedJob=e.finishedJob}return e.prototype.isSameWith=function(e){return this.finishedJob===e.finishedJob&&!this.startDate&&!e.startDate&&n(this.startDate,e.startDate)&&!this.endDate&&!e.endDate&&n(this.endDate,e.endDate)},e.prototype.isJobSatisfyQuery=function(e){return(!this.finishedJob||r.a.isJobFinished(e))&&r.a.isWithinDateRange(e.EndTimeWindow,this.startDate,this.endDate)},e.prototype.getStatusQuery=function(){return this.finishedJob?{Status:a.c}:void 0},e}()},za5F:function(e,t,i){"use strict";i.d(t,"a",function(){return u});var n=i("gIcY"),r=i("dEwP"),a=i("cPJV"),o=i("m8R6"),s=i("Wy0B"),c=(i("auuj"),i("D8hx"),i("Rf/f"),i("k8aw")),l=i("JQ8u"),u=function(){function e(e,t,i,n,r,a){this._fb=e,this._dialogRef=t,this._plannerRest=i,this._authentication=n,this._toast=r,this.data=a,this.selectedIndex=0,this.createNew=!1,this.isPowerPlanner=!1,this.readonly=!1,this.isPowerPlanner=this._authentication.isPowerPlanner()}return e.prototype.ngOnInit=function(){var e=this,t=this.data;this.readonly=t.readonly,t.order?(this.originalOrder=Object.assign({},t.order),this.createForm(this.originalOrder)):t.orderId?this._plannerRest.getDeliveryMaster(t.orderId,!0).subscribe(function(i){if(!i)return e._toast.shortAlert("Order "+t.orderId+" does not exist on database"),e._dialogRef.close();e.originalOrder=i,e.createForm(e.originalOrder),console.log("PlannerOrderDetailsDialogComponent ->  constructor -> this.order",e.originalOrder)},function(i){e._toast.shortAlert("Order "+t.orderId+" does not exist on database",i),e._dialogRef.close()}):(this.originalOrder=Object.assign({},s.a,{Id:a(new Date,"YYYY-MM-DD_HHmmss")}),this._authentication.isRestrictedPlanner()&&(this.originalOrder.UserGroup=this._authentication.getUserGroup()),this.createNew=!0,this.createForm(this.originalOrder),console.log("PlannerOrderDetailsDialogComponent ->  constructor -> createNew -> this.order",this.originalOrder))},e.prototype.selectTab=function(e,t){switch(e){case"Customer Info":this.selectedIndex=0;break;case"Summary":this.selectedIndex=1;break;default:var i=this.jobs.value[t].Id;this.selectedJob=i?this.originalOrder.DeliveryDetails.find(function(e){return e.Id&&e.Id===i}):void 0,this.selectedIndex=2+t}},e.prototype.save=function(){var e=this,t=[];if(this.createNew){var i=this.f.value,n=Object.assign({},this.order.value,{DeliveryDetails:this.jobs.value.map(function(e){return Object(o.a)(e,["Id"])})});this._authentication.isRestrictedPlanner()&&(n.UserGroup=this._authentication.getUserGroup()),n.DeliveryDetails.forEach(function(e){e.VerificationCode&&(e.VerificationCode={Code:e.VerificationCode})}),console.log("PlannerOrderDetailDialogComponent -> save -> newOrder",n,i),t.push(this._plannerRest.create(n,"DeliveryMaster"))}else if(this.order.dirty&&t.push(this._plannerRest.update(this.order.value,"DeliveryMaster")),this.jobs.dirty){var a=this.jobs.value.map(function(e){return e.Id}).filter(function(e){return e}),s=this.originalOrder.DeliveryDetails.map(function(e){return e.Id}).filter(function(e){return!a.includes(e)});s.length>0&&t.push(this._plannerRest.deleteMany(s,"DeliveryDetail")),this.jobs.controls.forEach(function(i){t.push.apply(t,e._getJobChangeQueries(i))})}r.a.apply(void 0,t).subscribe(function(t){e._toast.shortAlert("Order has been saved/created successfully")},function(t){return e._toast.shortAlert("Failed to save order",t)},function(){e._dialogRef.close()})},e.prototype.createForm=function(e){this.order=l.a.createForm(e,this.isPowerPlanner),this.jobs=new n.e(e.DeliveryDetails.map(function(e){return c.a.createForm(e)})),this.f=this._fb.group({DeliveryMaster:this.order,DeliveryDetails:this.jobs})},e.prototype.addNewJob=function(){var e=this.jobs.at(0).value,t=e.DeliveryItems.map(function(e){return{ItemId:e.ItemId,ItemQty:e.ItemQty}}),i=Object.assign({},e,{Id:void 0,DeliveryItems:t});"PICKUP"===e.JobType?(Object.assign(i,{JobType:"DELIVERY",JobSequence:e.JobSequence+1}),this.jobs.push(c.a.createForm(i)),this.selectTab("Job",1)):(Object.assign(i,{JobType:"PICKUP",JobSequence:e.JobSequence-1}),this.jobs.insert(0,c.a.createForm(i)),this.selectTab("Job",0)),console.log("PlannerOrderDetailDialogComponent -> addNewJob -> newJob",i)},e.prototype.jobDelete=function(e){this.jobs.removeAt(e),this.selectTab("Job",0)},e.prototype._getJobChangeQueries=function(e){var t=[],i=e.value,n=i.Id;if(n){if(i.StartTimeWindow=this._isValid(i.StartTimeWindow)?a(i.StartTimeWindow):"",i.EndTimeWindow=this._isValid(i.EndTimeWindow)?a(i.EndTimeWindow):"",t.push(i.VerificationCode?this._plannerRest.updateVerificationCode(n,i.VerificationCode):this._plannerRest.deleteVerificationCode(n)),t.push(this._plannerRest.update(i,"DeliveryDetail")),e.get("DeliveryItems").dirty){var r=e.get("DeliveryItems").value.filter(function(e){return e.ItemId&&e.ItemQty>0}).map(function(e){return{ItemId:e.ItemId,ItemQty:e.ItemQty}});t.push(this._plannerRest.replaceDeliveryItemsOfJob(n,r))}}else i.DeliveryMasterId=this.originalOrder.Id,t=[this._plannerRest.create(Object(o.a)(i,["Id"]),"DeliveryDetail")];return t},e.prototype._isValid=function(e){return!isNaN(new Date(e).getTime())},e}()}}]);